# API Contract: Query Endpoint

## Endpoint: `/query`

### POST /query

**Description**: Process a user query against the book content and return a structured response with answer, confidence score, and source references.

**Request**:
- **Method**: POST
- **Path**: `/query`
- **Content-Type**: `application/json`

**Request Body**:
```json
{
  "query": {
    "type": "string",
    "description": "The user's question about the book content",
    "minLength": 1,
    "maxLength": 1000,
    "example": "What are the main concepts of physical AI?"
  }
}
```

**Response**:
- **Success Response (200 OK)**:
```json
{
  "answer": {
    "type": "string",
    "description": "The answer generated by the system",
    "example": "Physical AI combines artificial intelligence algorithms with physical systems..."
  },
  "confidence": {
    "type": "number",
    "description": "Confidence score between 0 and 1",
    "minimum": 0,
    "maximum": 1,
    "example": 0.87
  },
  "sources": {
    "type": "array",
    "description": "List of source references used to generate the answer",
    "items": {
      "type": "object",
      "properties": {
        "content": {
          "type": "string",
          "description": "The text content of the source",
          "example": "Physical AI is the integration of artificial intelligence algorithms with physical systems..."
        },
        "metadata": {
          "type": "object",
          "description": "Additional metadata about the source",
          "properties": {
            "page": {
              "type": "integer",
              "description": "Page number in the source material"
            },
            "chapter": {
              "type": "string",
              "description": "Chapter title or identifier"
            },
            "url": {
              "type": "string",
              "description": "URL to the source material",
              "format": "uri"
            }
          }
        },
        "score": {
          "type": "number",
          "description": "Relevance score for this source",
          "minimum": 0,
          "maximum": 1,
          "example": 0.92
        }
      }
    }
  },
  "query_id": {
    "type": "string",
    "description": "Unique identifier for the query",
    "example": "query_12345"
  },
  "timestamp": {
    "type": "string",
    "description": "ISO 8601 timestamp of the response",
    "format": "date-time",
    "example": "2025-12-26T10:00:00Z"
  }
}
```

**Error Responses**:

- **Bad Request (400)**:
```json
{
  "error": "Bad Request",
  "message": "Description of the error",
  "status_code": 400
}
```

- **Unprocessable Entity (422)**:
```json
{
  "error": "Unprocessable Entity",
  "message": "Validation error details",
  "status_code": 422
}
```

- **Internal Server Error (500)**:
```json
{
  "error": "Internal Server Error",
  "message": "An unexpected error occurred",
  "status_code": 500
}
```

**Example Request**:
```http
POST /query
Content-Type: application/json

{
  "query": "What are the main concepts of physical AI?"
}
```

**Example Response**:
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "answer": "Physical AI combines artificial intelligence algorithms with physical systems...",
  "confidence": 0.87,
  "sources": [
    {
      "content": "Physical AI is the integration of artificial intelligence algorithms with physical systems...",
      "metadata": {
        "page": 25,
        "chapter": "Introduction to Physical AI",
        "url": "https://ai-book-hackathon-mu.vercel.app/chapter-1"
      },
      "score": 0.92
    }
  ],
  "query_id": "query_12345",
  "timestamp": "2025-12-26T10:00:00Z"
}
```