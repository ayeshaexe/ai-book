# Data Model: Backend-Frontend Integration

## Entities

### Query Request
**Description**: User input containing the question to be processed by the system
**Fields**:
- `query` (string, required): The user's question about the book content
- `context` (string, optional): Additional context for the query
- `user_id` (string, optional): Identifier for the user making the request

**Validation Rules**:
- Query must be between 1 and 1000 characters
- Query must not be empty or contain only whitespace

### Query Response
**Description**: Structured output containing the answer, confidence score, and source references
**Fields**:
- `answer` (string, required): The answer generated by the system
- `confidence` (number, required): Confidence score between 0 and 1
- `sources` (array of Source Information, required): List of source references used to generate the answer
- `query_id` (string, optional): Unique identifier for the query
- `timestamp` (string, optional): ISO 8601 timestamp of the response

**Validation Rules**:
- Answer must be provided and not empty
- Confidence must be a number between 0 and 1
- Sources array must contain at least one source if an answer is provided

### Source Information
**Description**: Book content segments that were used to generate the answer, with metadata about their origin
**Fields**:
- `content` (string, required): The text content of the source
- `metadata` (object, optional): Additional metadata about the source (e.g., page number, chapter, URL)
- `score` (number, optional): Relevance score for this source

**Validation Rules**:
- Content must be provided and not empty
- Score must be a number between 0 and 1 if provided

## State Transitions

### Query Processing Flow
1. **Pending**: Query received by the API but not yet processed
2. **Processing**: Query is being processed by the RAG agent
3. **Completed**: Query processing finished with a response
4. **Failed**: Query processing failed due to an error

## API Request/Response Examples

### Query Request Example
```json
{
  "query": "What are the main concepts of physical AI?"
}
```

### Successful Query Response Example
```json
{
  "answer": "Physical AI combines artificial intelligence with physical systems...",
  "confidence": 0.87,
  "sources": [
    {
      "content": "Physical AI is the integration of artificial intelligence algorithms with physical systems...",
      "metadata": {
        "page": 25,
        "chapter": "Introduction to Physical AI",
        "url": "https://ai-book-hackathon-mu.vercel.app/chapter-1"
      },
      "score": 0.92
    }
  ],
  "query_id": "query_12345",
  "timestamp": "2025-12-26T10:00:00Z"
}
```

### Error Response Example
```json
{
  "error": "Query could not be processed",
  "message": "The query was too short or empty",
  "status_code": 400
}
```